import{createPinia as e}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import'https://testingcf.jsdelivr.net/npm/jquery-ui/+esm';var t={102(e,t,n){var o=n(671);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,n(424).A)('258a90d1',o,!1,{ssrId:!0})},424(e,t,n){function o(e,t){for(var n=[],o={},a=0;a<t.length;a++){var r=t[a],l=r[0],c={id:e+':'+a,css:r[1],media:r[2],sourceMap:r[3]};o[l]?o[l].parts.push(c):n.push(o[l]={id:l,parts:[c]})}return n}n.d(t,{A:()=>f});var a='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!a)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},l=a&&(document.head||document.getElementsByTagName('head')[0]),c=null,i=0,s=!1,d=function(){},m=null,u='data-vue-ssr-id',p='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,n,a){s=n,m=a||{};var l=o(e,t);return h(l),function(t){for(var n=[],a=0;a<l.length;a++){var c=l[a];(i=r[c.id]).refs--,n.push(i)}t?h(l=o(e,t)):l=[];for(a=0;a<n.length;a++){var i;if(0===(i=n[a]).refs){for(var s=0;s<i.parts.length;s++)i.parts[s]();delete r[i.id]}}}}function h(e){for(var t=0;t<e.length;t++){var n=e[t],o=r[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(g(n.parts[a]));o.parts.length>n.parts.length&&(o.parts.length=n.parts.length)}else{var l=[];for(a=0;a<n.parts.length;a++)l.push(g(n.parts[a]));r[n.id]={id:n.id,refs:1,parts:l}}}}function v(){var e=document.createElement('style');return e.type='text/css',l.appendChild(e),e}function g(e){var t,n,o=document.querySelector('style['+u+'~="'+e.id+'"]');if(o){if(s)return d;o.parentNode.removeChild(o)}if(p){var a=i++;o=c||(c=v()),t=x.bind(null,o,a,!1),n=x.bind(null,o,a,!0)}else o=v(),t=B.bind(null,o),n=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else n()}}var A,b=(A=[],function(e,t){return A[e]=t,A.filter(Boolean).join('\n')});function x(e,t,n,o){var a=n?'':o.css;if(e.styleSheet)e.styleSheet.cssText=b(t,a);else{var r=document.createTextNode(a),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(r,l[t]):e.appendChild(r)}}function B(e,t){var n=t.css,o=t.media,a=t.sourceMap;if(o&&e.setAttribute('media',o),m.ssrId&&e.setAttribute(u,t.id),a&&(n+='\n/*# sourceURL='+a.sources[0]+' */',n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},465(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',o=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),o&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),o&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,o,a,r){'string'==typeof e&&(e=[[null,e,void 0]]);var l={};if(o)for(var c=0;c<this.length;c++){var i=this[c][0];null!=i&&(l[i]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&l[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=r),n&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=n):d[2]=n),a&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=a):d[4]=''.concat(a)),t.push(d))}},t}},671(e,t,n){n.r(t),n.d(t,{default:()=>c});var o=n(699),a=n.n(o),r=n(465),l=n.n(r)()(a());l.push([e.id,'.mobile-container[data-v-4dc74265]{width:100%;height:100%}.mobile-fab[data-v-4dc74265]{width:56px;height:56px;border-radius:50%;background-color:#3b82f6;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:center;border:none;cursor:pointer}.mobile-fab[data-v-4dc74265]:active{transform:scale(0.95)}.mobile-fullscreen[data-v-4dc74265]{position:absolute;inset:0;background:white;display:flex;flex-direction:column}.mobile-header[data-v-4dc74265]{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid #e5e7eb;background:white}.mobile-content[data-v-4dc74265]{flex:1;padding:16px;display:flex;flex-direction:column;gap:16px;overflow-y:auto}.branch-list-mobile[data-v-4dc74265]{border:1px solid #e5e7eb;border-radius:8px;max-height:256px;overflow-y:auto}.branch-item-mobile[data-v-4dc74265]{padding:12px;cursor:pointer;border-bottom:1px solid #e5e7eb}.branch-item-mobile[data-v-4dc74265]:last-child{border-bottom:none}.branch-item-mobile.active[data-v-4dc74265]{background-color:#eff6ff}.desktop-container[data-v-4dc74265]{background:white;border-radius:8px;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);border:1px solid #e5e7eb;overflow:hidden}.desktop-collapsed[data-v-4dc74265]{display:flex;align-items:center;justify-content:space-between;padding:12px;cursor:pointer}.desktop-collapsed[data-v-4dc74265]:hover{background-color:#f9fafb}.desktop-header[data-v-4dc74265]{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid #e5e7eb;cursor:move;background-color:#f9fafb}.desktop-toolbar[data-v-4dc74265]{display:flex;align-items:center;gap:8px;padding:12px;border-bottom:1px solid #e5e7eb}.branch-list-desktop[data-v-4dc74265]{max-height:256px;overflow-y:auto}.branch-item-desktop[data-v-4dc74265]{padding:12px;cursor:pointer;transition:background-color 0.15s}.branch-item-desktop[data-v-4dc74265]:hover{background-color:#f9fafb}.branch-item-desktop.active[data-v-4dc74265]{background-color:#eff6ff;border-left:4px solid #3b82f6}.text-lg[data-v-4dc74265]{font-size:1.125rem;line-height:1.75rem}.text-sm[data-v-4dc74265]{font-size:0.875rem;line-height:1.25rem}.text-xs[data-v-4dc74265]{font-size:0.75rem;line-height:1rem}.text-2xl[data-v-4dc74265]{font-size:1.5rem;line-height:2rem}.text-xl[data-v-4dc74265]{font-size:1.25rem;line-height:1.75rem}.font-semibold[data-v-4dc74265]{font-weight:600}.font-medium[data-v-4dc74265]{font-weight:500}.text-white[data-v-4dc74265]{color:white}.text-gray-400[data-v-4dc74265]{color:#9ca3af}.text-gray-500[data-v-4dc74265]{color:#6b7280}.text-gray-600[data-v-4dc74265]{color:#4b5563}.text-blue-500[data-v-4dc74265]{color:#3b82f6}.text-red-500[data-v-4dc74265]{color:#ef4444}.bg-white[data-v-4dc74265]{background-color:white}.bg-blue-500[data-v-4dc74265]{background-color:#3b82f6}.bg-gray-200[data-v-4dc74265]{background-color:#e5e7eb}.bg-red-500[data-v-4dc74265]{background-color:#ef4444}.rounded[data-v-4dc74265]{border-radius:4px}.rounded-lg[data-v-4dc74265]{border-radius:8px}.border[data-v-4dc74265]{border:1px solid #e5e7eb}.p-2[data-v-4dc74265]{padding:8px}.p-4[data-v-4dc74265]{padding:16px}.px-2[data-v-4dc74265]{padding-left:8px;padding-right:8px}.px-3[data-v-4dc74265]{padding-left:12px;padding-right:12px}.px-4[data-v-4dc74265]{padding-left:16px;padding-right:16px}.py-1\\.5[data-v-4dc74265]{padding-top:6px;padding-bottom:6px}.py-3[data-v-4dc74265]{padding-top:12px;padding-bottom:12px}.p-1\\.5[data-v-4dc74265]{padding:6px}.mb-2[data-v-4dc74265]{margin-bottom:8px}.mr-2[data-v-4dc74265]{margin-right:8px}.ml-2[data-v-4dc74265]{margin-left:8px}.mt-1[data-v-4dc74265]{margin-top:4px}.pt-2[data-v-4dc74265]{padding-top:8px}.gap-1[data-v-4dc74265]{gap:4px}.gap-2[data-v-4dc74265]{gap:8px}.flex[data-v-4dc74265]{display:flex}.flex-1[data-v-4dc74265]{flex:1}.flex-col[data-v-4dc74265]{flex-direction:column}.items-center[data-v-4dc74265]{align-items:center}.justify-between[data-v-4dc74265]{justify-content:space-between}.w-full[data-v-4dc74265]{width:100%}.min-w-0[data-v-4dc74265]{min-width:0}.min-h-\\[44px\\][data-v-4dc74265]{min-height:44px}.truncate[data-v-4dc74265]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cursor-pointer[data-v-4dc74265]{cursor:pointer}.block[data-v-4dc74265]{display:block}.divide-y[data-v-4dc74265]>*+*{border-top:1px solid #e5e7eb}.transition-colors[data-v-4dc74265]{transition-property:color,background-color,border-color;transition-duration:150ms}.hover\\:bg-blue-600[data-v-4dc74265]:hover{background-color:#2563eb}.hover\\:text-gray-600[data-v-4dc74265]:hover{color:#4b5563}.hover\\:text-gray-700[data-v-4dc74265]:hover{color:#374151}.hover\\:text-red-700[data-v-4dc74265]:hover{color:#b91c1c}body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,\'Helvetica Neue\',Arial,sans-serif}\n','',{version:3,sources:['webpack://./src/预设分支管理/FloatingWindow.vue'],names:[],mappings:'AAqcA,mCAAoB,UAAW,CAAE,WAAc,CAC/C,6BAAc,UAAW,CAAE,WAAY,CAAE,iBAAkB,CAAE,wBAAyB,CAAE,yCAA6C,CAAE,YAAa,CAAE,kBAAmB,CAAE,sBAAuB,CAAE,WAAY,CAAE,cAAiB,CACnO,oCAAqB,qBAAwB,CAC7C,oCAAqB,iBAAkB,CAAE,OAAQ,CAAE,gBAAiB,CAAE,YAAa,CAAE,qBAAwB,CAC7G,gCAAiB,YAAa,CAAE,kBAAmB,CAAE,6BAA8B,CAAE,YAAa,CAAE,+BAAgC,CAAE,gBAAmB,CACzJ,iCAAkB,MAAO,CAAE,YAAa,CAAE,YAAa,CAAE,qBAAsB,CAAE,QAAS,CAAE,eAAkB,CAC9G,qCAAsB,wBAAyB,CAAE,iBAAkB,CAAE,gBAAiB,CAAE,eAAkB,CAC1G,qCAAsB,YAAa,CAAE,cAAe,CAAE,+BAAkC,CACxF,gDAAiC,kBAAqB,CACtD,4CAA6B,wBAA2B,CAGxD,oCAAqB,gBAAiB,CAAE,iBAAkB,CAAE,2CAA+C,CAAE,wBAAyB,CAAE,eAAkB,CAC1J,oCAAqB,YAAa,CAAE,kBAAmB,CAAE,6BAA8B,CAAE,YAAa,CAAE,cAAiB,CACzH,0CAA2B,wBAA2B,CACtD,iCAAkB,YAAa,CAAE,kBAAmB,CAAE,6BAA8B,CAAE,YAAa,CAAE,+BAAgC,CAAE,WAAY,CAAE,wBAA2B,CAChL,kCAAmB,YAAa,CAAE,kBAAmB,CAAE,OAAQ,CAAE,YAAa,CAAE,+BAAkC,CAClH,sCAAuB,gBAAiB,CAAE,eAAkB,CAC5D,sCAAuB,YAAa,CAAE,cAAe,CAAE,iCAAoC,CAC3F,4CAA6B,wBAA2B,CACxD,6CAA8B,wBAAyB,CAAE,6BAAgC,CAGzF,0BAAW,kBAAmB,CAAE,mBAAsB,CACtD,0BAAW,kBAAmB,CAAE,mBAAsB,CACtD,0BAAW,iBAAkB,CAAE,gBAAmB,CAClD,2BAAY,gBAAiB,CAAE,gBAAmB,CAClD,0BAAW,iBAAkB,CAAE,mBAAsB,CACrD,gCAAiB,eAAkB,CACnC,8BAAe,eAAkB,CACjC,6BAAc,WAAc,CAC5B,gCAAiB,aAAgB,CACjC,gCAAiB,aAAgB,CACjC,gCAAiB,aAAgB,CACjC,gCAAiB,aAAgB,CACjC,+BAAgB,aAAgB,CAChC,2BAAY,sBAAyB,CACrC,8BAAe,wBAA2B,CAC1C,8BAAe,wBAA2B,CAC1C,6BAAc,wBAA2B,CACzC,0BAAW,iBAAoB,CAC/B,6BAAc,iBAAoB,CAClC,yBAAU,wBAA2B,CACrC,sBAAO,WAAc,CACrB,sBAAO,YAAe,CACtB,uBAAQ,gBAAiB,CAAE,iBAAoB,CAC/C,uBAAQ,iBAAkB,CAAE,kBAAqB,CACjD,uBAAQ,iBAAkB,CAAE,kBAAqB,CACjD,0BAAW,eAAgB,CAAE,kBAAqB,CAClD,uBAAQ,gBAAiB,CAAE,mBAAsB,CACjD,yBAAU,WAAc,CACxB,uBAAQ,iBAAoB,CAC5B,uBAAQ,gBAAmB,CAC3B,uBAAQ,eAAkB,CAC1B,uBAAQ,cAAiB,CACzB,uBAAQ,eAAkB,CAC1B,wBAAS,OAAU,CACnB,wBAAS,OAAU,CACnB,uBAAQ,YAAe,CACvB,yBAAU,MAAS,CACnB,2BAAY,qBAAwB,CACpC,+BAAgB,kBAAqB,CACrC,kCAAmB,6BAAgC,CACnD,yBAAU,UAAa,CACvB,0BAAW,WAAc,CACzB,iCAAkB,eAAkB,CACpC,2BAAY,eAAgB,CAAE,sBAAuB,CAAE,kBAAqB,CAC5E,iCAAkB,cAAiB,CACnC,wBAAS,aAAgB,CACzB,+BAAoB,4BAA+B,CACnD,oCAAqB,uDAA0D,CAAE,yBAA4B,CAC7G,2CAA4B,wBAA2B,CACvD,6CAA8B,aAAgB,CAC9C,6CAA8B,aAAgB,CAC9C,4CAA6B,aAAgB,CAE7C,KAAgB,QAAS,CAAE,SAAU,CAAE,gGAAyG',sourcesContent:['<template>\n  \x3c!-- 移动端：底部浮动按钮 --\x3e\n  <div v-if="isMobile" class="mobile-container">\n    <button v-if="!isExpanded"\n            @click="toggleExpand"\n            class="mobile-fab">\n      <i class="fas fa-code-branch text-2xl text-white"></i>\n    </button>\n\n    \x3c!-- 移动端全屏展开 --\x3e\n    <div v-else class="mobile-fullscreen">\n      <div class="mobile-header">\n        <h2 class="text-lg font-semibold">预设分支管理</h2>\n        <button @click="toggleExpand" class="p-2">\n          <i class="fas fa-times text-xl text-gray-600"></i>\n        </button>\n      </div>\n\n      <div class="mobile-content">\n        \x3c!-- 预设选择 --\x3e\n        <div>\n          <label class="block text-sm font-medium mb-2">选择预设</label>\n          <select v-model="selectedPreset"\n                  @change="onPresetChange"\n                  class="w-full min-h-[44px] rounded-lg border px-4 py-3 bg-white">\n            <option v-for="preset in presetNames" :key="preset" :value="preset">\n              {{ preset }}\n            </option>\n          </select>\n        </div>\n\n        \x3c!-- 分支选择 --\x3e\n        <div>\n          <label class="block text-sm font-medium mb-2">选择分支</label>\n          <div class="flex gap-2">\n            <select v-model="selectedBranch"\n                    @change="onBranchChange"\n                    class="flex-1 min-h-[44px] rounded-lg border px-4 py-3 bg-white">\n              <option v-if="!branches.length" value="">无分支</option>\n              <option v-for="branch in branches" :key="branch.name" :value="branch.name">\n                {{ branch.name }}\n              </option>\n            </select>\n          </div>\n        </div>\n\n        \x3c!-- 分支列表 --\x3e\n        <div v-if="branches.length > 0" class="branch-list-mobile">\n          <div v-for="branch in branches"\n               :key="branch.name"\n               @click="switchToBranch(branch.name)"\n               :class="[\'branch-item-mobile\', branch.isActive ? \'active\' : \'\']">\n            <div class="flex items-center justify-between">\n              <div class="flex-1 min-w-0">\n                <div class="text-sm font-medium truncate">{{ branch.name }}</div>\n                <div v-if="branch.description" class="text-xs text-gray-500 truncate mt-1">\n                  {{ branch.description }}\n                </div>\n              </div>\n              <i v-if="branch.isActive" class="fas fa-check text-blue-500 ml-2"></i>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- 操作按钮 --\x3e\n        <div class="flex flex-col gap-2 pt-2">\n          <button @click="openEditModal"\n                  class="w-full min-h-[44px] rounded-lg bg-blue-500 px-4 py-3 text-white font-medium">\n            <i class="fas fa-edit mr-2"></i>修改条目\n          </button>\n\n          <div v-if="selectedBranch" class="flex gap-2">\n            <button @click="openRenameModal"\n                    class="flex-1 min-h-[44px] rounded-lg bg-gray-200 px-4 py-3 font-medium">\n              <i class="fas fa-edit mr-2"></i>重命名\n            </button>\n            <button @click="openDeleteModal"\n                    class="flex-1 min-h-[44px] rounded-lg bg-red-500 px-4 py-3 text-white font-medium">\n              <i class="fas fa-trash mr-2"></i>删除\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- 桌面端：悬浮窗 --\x3e\n  <div v-else class="desktop-container">\n    \x3c!-- 折叠状态 --\x3e\n    <div v-if="!isExpanded"\n         class="desktop-collapsed"\n         @click="toggleExpand">\n      <span class="text-sm font-medium">预设分支</span>\n      <i class="fas fa-chevron-down text-gray-400"></i>\n    </div>\n\n    \x3c!-- 展开状态 --\x3e\n    <div v-else>\n      \x3c!-- 顶部栏 --\x3e\n      <div class="desktop-header" ref="dragHandle">\n        <span class="text-sm font-medium">预设分支</span>\n        <button @click="toggleExpand" class="text-gray-400 hover:text-gray-600">\n          <i class="fas fa-chevron-up"></i>\n        </button>\n      </div>\n\n      \x3c!-- 工具栏 --\x3e\n      <div class="desktop-toolbar">\n        <button @click="openEditModal"\n                class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">\n          修改\n        </button>\n\n        <select v-model="selectedPreset"\n                @change="onPresetChange"\n                class="flex-1 text-sm border rounded px-2 py-1.5 bg-white cursor-pointer">\n          <option v-for="preset in presetNames" :key="preset" :value="preset">\n            {{ preset }}\n          </option>\n        </select>\n\n        <select v-model="selectedBranch"\n                @change="onBranchChange"\n                class="flex-1 text-sm border rounded px-2 py-1.5 bg-white cursor-pointer">\n          <option v-if="!branches.length" value="">无分支</option>\n          <option v-for="branch in branches" :key="branch.name" :value="branch.name">\n            {{ branch.name }}\n          </option>\n        </select>\n\n        <div v-if="selectedBranch" class="flex gap-1">\n          <button @click="openRenameModal"\n                  class="p-1.5 text-gray-500 hover:text-gray-700 transition-colors"\n                  title="重命名">\n            <i class="fas fa-edit text-xs"></i>\n          </button>\n          <button @click="openDeleteModal"\n                  class="p-1.5 text-red-500 hover:text-red-700 transition-colors"\n                  title="删除">\n            <i class="fas fa-trash text-xs"></i>\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- 分支列表 --\x3e\n      <div class="branch-list-desktop">\n        <div v-if="!branches.length" class="p-4 text-center text-gray-500 text-sm">\n          暂无分支\n        </div>\n        <div v-else class="divide-y">\n          <div v-for="branch in branches"\n               :key="branch.name"\n               @click="switchToBranch(branch.name)"\n               :class="[\'branch-item-desktop\', branch.isActive ? \'active\' : \'\']">\n            <div class="flex items-center justify-between">\n              <div class="flex-1 min-w-0">\n                <div class="text-sm font-medium truncate">{{ branch.name }}</div>\n                <div v-if="branch.description" class="text-xs text-gray-500 truncate mt-1">\n                  {{ branch.description }}\n                </div>\n              </div>\n              <i v-if="branch.isActive" class="fas fa-check text-blue-500"></i>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { useBreakpoints } from \'@vueuse/core\';\nimport $ from \'jquery\';\nimport \'jquery-ui\';\nimport toastr from \'toastr\';\nimport { nextTick, onMounted, ref, watch } from \'vue\';\nimport { getActiveBranchName, getBranchList, getCurrentPresetName, getPresetList, switchBranch } from \'./branch-manager\';\nimport { BranchListItem } from \'./types\';\n\nconst emit = defineEmits<{\n  edit: [];\n  rename: [branchName: string];\n  delete: [branchName: string];\n}>();\n\nconst breakpoints = useBreakpoints({\n  mobile: 640,\n});\n\nconst isMobile = breakpoints.smaller(\'mobile\');\nconst isExpanded = ref(true);\nconst dragHandle = ref<HTMLElement | null>(null);\n\n// 预设和分支数据\nconst presetNames = ref<string[]>([]);\nconst selectedPreset = ref(\'\');\nconst branches = ref<BranchListItem[]>([]);\nconst selectedBranch = ref(\'\');\n\n// 获取父级 iframe 元素\nfunction getParentIframe(): HTMLIFrameElement | null {\n  return window.frameElement as HTMLIFrameElement | null;\n}\n\n// 更新 iframe 大小\nfunction updateIframeSize() {\n  const iframe = getParentIframe();\n  if (!iframe) return;\n\n  const $iframe = $(iframe);\n\n  if (isMobile.value) {\n    if (isExpanded.value) {\n      // 移动端展开：全屏\n      $iframe.css({\n        position: \'fixed\',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        width: \'100%\',\n        height: \'100%\',\n        transform: \'none\',\n        maxHeight: \'none\',\n      });\n    } else {\n      // 移动端折叠：右下角浮动按钮\n      $iframe.css({\n        position: \'fixed\',\n        top: \'auto\',\n        left: \'auto\',\n        right: \'16px\',\n        bottom: \'16px\',\n        width: \'56px\',\n        height: \'56px\',\n        transform: \'none\',\n        maxHeight: \'none\',\n      });\n    }\n  } else {\n    // 桌面端：固定宽度，高度自适应\n    $iframe.css({\n      position: \'fixed\',\n      right: \'auto\',\n      bottom: \'auto\',\n      width: \'320px\',\n      height: \'auto\',\n      maxHeight: \'80vh\',\n    });\n\n    // 延迟计算实际高度\n    nextTick(() => {\n      const contentHeight = document.body.scrollHeight;\n      $iframe.css(\'height\', Math.min(contentHeight, window.parent.innerHeight * 0.8) + \'px\');\n    });\n  }\n}\n\n// 初始化\nonMounted(async () => {\n  await loadPresetNames();\n  await loadCurrentPreset();\n\n  // 初始化 iframe 大小\n  updateIframeSize();\n\n  // 桌面端初始化拖动功能\n  if (!isMobile.value) {\n    await nextTick();\n    initDraggable();\n  }\n});\n\n// 监听展开状态变化，更新 iframe 大小\nwatch(isExpanded, () => {\n  nextTick(() => {\n    updateIframeSize();\n    if (!isMobile.value && isExpanded.value) {\n      nextTick(initDraggable);\n    }\n  });\n});\n\n// 监听分支列表变化，更新 iframe 高度\nwatch(branches, () => {\n  if (!isMobile.value) {\n    nextTick(updateIframeSize);\n  }\n}, { deep: true });\n\nfunction initDraggable() {\n  if (!dragHandle.value) return;\n\n  const iframe = getParentIframe();\n  if (!iframe) return;\n\n  const $iframe = $(iframe);\n\n  // 恢复保存的位置或使用居中位置\n  const saved = localStorage.getItem(\'preset-branch-position\');\n  if (saved) {\n    try {\n      const { left, top } = JSON.parse(saved);\n      $iframe.css({ left: left + \'px\', top: top + \'px\', transform: \'none\' });\n    } catch (e) {\n      console.error(\'恢复悬浮窗位置失败:\', e);\n    }\n  }\n\n  // 使用原生拖动实现（因为 jquery-ui draggable 在跨 iframe 时有问题）\n  let isDragging = false;\n  let startX = 0;\n  let startY = 0;\n  let startLeft = 0;\n  let startTop = 0;\n\n  const onMouseDown = (e: MouseEvent) => {\n    isDragging = true;\n    startX = e.clientX;\n    startY = e.clientY;\n    const rect = iframe.getBoundingClientRect();\n    startLeft = rect.left;\n    startTop = rect.top;\n    e.preventDefault();\n  };\n\n  const onMouseMove = (e: MouseEvent) => {\n    if (!isDragging) return;\n    const deltaX = e.clientX - startX;\n    const deltaY = e.clientY - startY;\n    const newLeft = startLeft + deltaX;\n    const newTop = startTop + deltaY;\n    $iframe.css({\n      left: newLeft + \'px\',\n      top: newTop + \'px\',\n      transform: \'none\',\n    });\n  };\n\n  const onMouseUp = () => {\n    if (isDragging) {\n      isDragging = false;\n      // 保存位置\n      const rect = iframe.getBoundingClientRect();\n      localStorage.setItem(\n        \'preset-branch-position\',\n        JSON.stringify({ left: rect.left, top: rect.top })\n      );\n    }\n  };\n\n  dragHandle.value.addEventListener(\'mousedown\', onMouseDown);\n  window.parent.document.addEventListener(\'mousemove\', onMouseMove);\n  window.parent.document.addEventListener(\'mouseup\', onMouseUp);\n}\n\nasync function loadPresetNames() {\n  try {\n    const allPresets = await getPresetList();\n    presetNames.value = allPresets;\n  } catch (error) {\n    console.error(\'加载预设列表失败:\', error);\n    toastr.error(\'加载预设列表失败\');\n  }\n}\n\nasync function loadCurrentPreset() {\n  try {\n    const currentPresetName = getCurrentPresetName();\n    if (currentPresetName) {\n      selectedPreset.value = currentPresetName;\n      await loadBranches(selectedPreset.value);\n      selectedBranch.value = getActiveBranchName(selectedPreset.value) || \'\';\n    }\n  } catch (error) {\n    console.error(\'加载当前预设失败:\', error);\n  }\n}\n\nasync function loadBranches(presetName: string) {\n  try {\n    branches.value = getBranchList(presetName);\n  } catch (error) {\n    console.error(\'加载分支列表失败:\', error);\n    branches.value = [];\n  }\n}\n\nasync function onPresetChange() {\n  try {\n    await loadBranches(selectedPreset.value);\n    selectedBranch.value = getActiveBranchName(selectedPreset.value) || \'\';\n  } catch (error) {\n    console.error(\'切换预设失败:\', error);\n    toastr.error(\'切换预设失败\');\n  }\n}\n\nasync function onBranchChange() {\n  if (!selectedBranch.value) return;\n\n  try {\n    const success = switchBranch(selectedPreset.value, selectedBranch.value);\n    if (success) {\n      await loadBranches(selectedPreset.value);\n      toastr.success(\'切换分支成功\');\n    } else {\n      toastr.error(\'切换分支失败\');\n    }\n  } catch (error) {\n    console.error(\'切换分支失败:\', error);\n    toastr.error(\'切换分支失败\');\n  }\n}\n\nasync function switchToBranch(branchName: string) {\n  selectedBranch.value = branchName;\n  await onBranchChange();\n}\n\nfunction toggleExpand() {\n  isExpanded.value = !isExpanded.value;\n}\n\nfunction openEditModal() {\n  emit(\'edit\');\n}\n\nfunction openRenameModal() {\n  if (selectedBranch.value) {\n    emit(\'rename\', selectedBranch.value);\n  }\n}\n\nfunction openDeleteModal() {\n  if (selectedBranch.value) {\n    emit(\'delete\', selectedBranch.value);\n  }\n}\n\n// 暴露方法供外部调用\ndefineExpose({\n  refreshPreset: loadCurrentPreset,\n  refreshBranches: async () => {\n    if (selectedPreset.value) {\n      await loadBranches(selectedPreset.value);\n    }\n  },\n});\n<\/script>\n\n<style scoped>\n/* 移动端样式 */\n.mobile-container { width: 100%; height: 100%; }\n.mobile-fab { width: 56px; height: 56px; border-radius: 50%; background-color: #3b82f6; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; }\n.mobile-fab:active { transform: scale(0.95); }\n.mobile-fullscreen { position: absolute; inset: 0; background: white; display: flex; flex-direction: column; }\n.mobile-header { display: flex; align-items: center; justify-content: space-between; padding: 16px; border-bottom: 1px solid #e5e7eb; background: white; }\n.mobile-content { flex: 1; padding: 16px; display: flex; flex-direction: column; gap: 16px; overflow-y: auto; }\n.branch-list-mobile { border: 1px solid #e5e7eb; border-radius: 8px; max-height: 256px; overflow-y: auto; }\n.branch-item-mobile { padding: 12px; cursor: pointer; border-bottom: 1px solid #e5e7eb; }\n.branch-item-mobile:last-child { border-bottom: none; }\n.branch-item-mobile.active { background-color: #eff6ff; }\n\n/* 桌面端样式 */\n.desktop-container { background: white; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid #e5e7eb; overflow: hidden; }\n.desktop-collapsed { display: flex; align-items: center; justify-content: space-between; padding: 12px; cursor: pointer; }\n.desktop-collapsed:hover { background-color: #f9fafb; }\n.desktop-header { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid #e5e7eb; cursor: move; background-color: #f9fafb; }\n.desktop-toolbar { display: flex; align-items: center; gap: 8px; padding: 12px; border-bottom: 1px solid #e5e7eb; }\n.branch-list-desktop { max-height: 256px; overflow-y: auto; }\n.branch-item-desktop { padding: 12px; cursor: pointer; transition: background-color 0.15s; }\n.branch-item-desktop:hover { background-color: #f9fafb; }\n.branch-item-desktop.active { background-color: #eff6ff; border-left: 4px solid #3b82f6; }\n\n/* 通用工具类 */\n.text-lg { font-size: 1.125rem; line-height: 1.75rem; }\n.text-sm { font-size: 0.875rem; line-height: 1.25rem; }\n.text-xs { font-size: 0.75rem; line-height: 1rem; }\n.text-2xl { font-size: 1.5rem; line-height: 2rem; }\n.text-xl { font-size: 1.25rem; line-height: 1.75rem; }\n.font-semibold { font-weight: 600; }\n.font-medium { font-weight: 500; }\n.text-white { color: white; }\n.text-gray-400 { color: #9ca3af; }\n.text-gray-500 { color: #6b7280; }\n.text-gray-600 { color: #4b5563; }\n.text-blue-500 { color: #3b82f6; }\n.text-red-500 { color: #ef4444; }\n.bg-white { background-color: white; }\n.bg-blue-500 { background-color: #3b82f6; }\n.bg-gray-200 { background-color: #e5e7eb; }\n.bg-red-500 { background-color: #ef4444; }\n.rounded { border-radius: 4px; }\n.rounded-lg { border-radius: 8px; }\n.border { border: 1px solid #e5e7eb; }\n.p-2 { padding: 8px; }\n.p-4 { padding: 16px; }\n.px-2 { padding-left: 8px; padding-right: 8px; }\n.px-3 { padding-left: 12px; padding-right: 12px; }\n.px-4 { padding-left: 16px; padding-right: 16px; }\n.py-1\\.5 { padding-top: 6px; padding-bottom: 6px; }\n.py-3 { padding-top: 12px; padding-bottom: 12px; }\n.p-1\\.5 { padding: 6px; }\n.mb-2 { margin-bottom: 8px; }\n.mr-2 { margin-right: 8px; }\n.ml-2 { margin-left: 8px; }\n.mt-1 { margin-top: 4px; }\n.pt-2 { padding-top: 8px; }\n.gap-1 { gap: 4px; }\n.gap-2 { gap: 8px; }\n.flex { display: flex; }\n.flex-1 { flex: 1; }\n.flex-col { flex-direction: column; }\n.items-center { align-items: center; }\n.justify-between { justify-content: space-between; }\n.w-full { width: 100%; }\n.min-w-0 { min-width: 0; }\n.min-h-\\[44px\\] { min-height: 44px; }\n.truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n.cursor-pointer { cursor: pointer; }\n.block { display: block; }\n.divide-y > * + * { border-top: 1px solid #e5e7eb; }\n.transition-colors { transition-property: color, background-color, border-color; transition-duration: 150ms; }\n.hover\\:bg-blue-600:hover { background-color: #2563eb; }\n.hover\\:text-gray-600:hover { color: #4b5563; }\n.hover\\:text-gray-700:hover { color: #374151; }\n.hover\\:text-red-700:hover { color: #b91c1c; }\n\n:global(body) { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, \'Helvetica Neue\', Arial, sans-serif; }\n</style>\n'],sourceRoot:''}]);const c=l},699(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),a='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),r='/*# '.concat(a,' */');return[t].concat([r]).join('\n')}return[t].join('\n')}},889(e,t){t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,o]of t)n[e]=o;return n}}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={id:e,exports:{}};return t[e](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const a=$;var r=o.n(a);const l=_;var c=o.n(l);const i=toastr;var s=o.n(i);const d=Vue;function m(e){return!!(0,d.getCurrentScope)()&&((0,d.onScopeDispose)(e),!0)}const u=new WeakMap,p=(...e)=>{var t;const n=e[0],o=null==(t=(0,d.getCurrentInstance)())?void 0:t.proxy;if(null==o&&!(0,d.hasInjectionContext)())throw new Error('injectLocal must be called in setup');return o&&u.has(o)&&n in u.get(o)?u.get(o)[n]:(0,d.inject)(...e)};const f='undefined'!=typeof window&&'undefined'!=typeof document,h=('undefined'!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString),v=e=>'[object Object]'===h.call(e);function g(e){return e.endsWith('rem')?16*Number.parseFloat(e):Number.parseFloat(e)}function A(e){return Array.isArray(e)?e:[e]}function b(e){const t=Object.create(null);return n=>t[n]||(t[n]=e(n))}const x=/\B([A-Z])/g,B=(b(e=>e.replace(x,'-$1').toLowerCase()),/-(\w)/g);b(e=>e.replace(B,(_,e)=>e?e.toUpperCase():''));function C(e){return e||(0,d.getCurrentInstance)()}const y=f?window:void 0;f&&window.document,f&&window.navigator,f&&window.location;function w(e){var t;const n=(0,d.toValue)(e);return null!=(t=null==n?void 0:n.$el)?t:n}function k(...e){const t=[],n=()=>{t.forEach(e=>e()),t.length=0},o=(0,d.computed)(()=>{const t=A((0,d.toValue)(e[0])).filter(e=>null!=e);return t.every(e=>'string'!=typeof e)?t:void 0}),a=(r=()=>{var t,n;return[null!=(n=null==(t=o.value)?void 0:t.map(e=>w(e)))?n:[y].filter(e=>null!=e),A((0,d.toValue)(o.value?e[1]:e[0])),A((0,d.unref)(o.value?e[2]:e[1])),(0,d.toValue)(o.value?e[3]:e[2])]},l=([e,o,a,r])=>{if(n(),!(null==e?void 0:e.length)||!(null==o?void 0:o.length)||!(null==a?void 0:a.length))return;const l=v(r)?{...r}:r;t.push(...e.flatMap(e=>o.flatMap(t=>a.map(n=>((e,t,n,o)=>(e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)))(e,t,n,l)))))},c={flush:'post'},(0,d.watch)(r,l,{...c,immediate:!0}));var r,l,c;return m(n),()=>{a(),n()}}function E(e){const t=function(){const e=(0,d.shallowRef)(!1),t=(0,d.getCurrentInstance)();return t&&(0,d.onMounted)(()=>{e.value=!0},t),e}();return(0,d.computed)(()=>(t.value,Boolean(e())))}const N=Symbol('vueuse-ssr-width');function V(){const e=(0,d.hasInjectionContext)()?p(N,null):null;return'number'==typeof e?e:void 0}function M(e,t={}){const{window:n=y,ssrWidth:o=V()}=t,a=E(()=>n&&'matchMedia'in n&&'function'==typeof n.matchMedia),r=(0,d.shallowRef)('number'==typeof o),l=(0,d.shallowRef)(),c=(0,d.shallowRef)(!1);return(0,d.watchEffect)(()=>{if(r.value){r.value=!a.value;const t=(0,d.toValue)(e).split(',');return void(c.value=t.some(e=>{const t=e.includes('not all'),n=e.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),a=e.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let r=Boolean(n||a);return n&&r&&(r=o>=g(n[1])),a&&r&&(r=o<=g(a[1])),t?!r:r}))}a.value&&(l.value=n.matchMedia((0,d.toValue)(e)),c.value=l.value.matches)}),k(l,'change',e=>{c.value=e.matches},{passive:!0}),(0,d.computed)(()=>c.value)}function j(e,t={}){function n(t,n){let o=(0,d.toValue)(e[(0,d.toValue)(t)]);return null!=n&&(o=function(e,t){var n;if('number'==typeof e)return e+t;const o=(null==(n=e.match(/^-?\d+\.?\d*/))?void 0:n[0])||'',a=e.slice(o.length),r=Number.parseFloat(o)+t;return Number.isNaN(r)?e:r+a}(o,n)),'number'==typeof o&&(o=`${o}px`),o}const{window:o=y,strategy:a='min-width',ssrWidth:r=V()}=t,l='number'==typeof r,c=l?(0,d.shallowRef)(!1):{value:!0};function i(e,t){return!c.value&&l?'min'===e?r>=g(t):r<=g(t):!!o&&o.matchMedia(`(${e}-width: ${t})`).matches}l&&function(e,t=!0,n){C(n)?(0,d.onMounted)(e,n):t?e():(0,d.nextTick)(e)}(()=>c.value=!!o);const s=e=>M(()=>`(min-width: ${n(e)})`,t),m=e=>M(()=>`(max-width: ${n(e)})`,t),u=Object.keys(e).reduce((e,t)=>(Object.defineProperty(e,t,{get:()=>'min-width'===a?s(t):m(t),enumerable:!0,configurable:!0}),e),{});function p(){const t=Object.keys(e).map(e=>[e,u[e],g(n(e))]).sort((e,t)=>e[2]-t[2]);return(0,d.computed)(()=>t.filter(([,e])=>e.value).map(([e])=>e))}return Object.assign(u,{greaterOrEqual:s,smallerOrEqual:m,greater:e=>M(()=>`(min-width: ${n(e,.1)})`,t),smaller:e=>M(()=>`(max-width: ${n(e,-.1)})`,t),between:(e,o)=>M(()=>`(min-width: ${n(e)}) and (max-width: ${n(o,-.1)})`,t),isGreater:e=>i('min',n(e,.1)),isGreaterOrEqual:e=>i('min',n(e)),isSmaller:e=>i('max',n(e,-.1)),isSmallerOrEqual:e=>i('max',n(e)),isInBetween:(e,t)=>i('min',n(e))&&i('max',n(t,-.1)),current:p,active(){const e=p();return(0,d.computed)(()=>0===e.value.length?'':e.value.at('min-width'===a?-1:0))}})}'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self&&self;Number.POSITIVE_INFINITY;const S={class:'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 p-4'},D={class:'flex items-center justify-between border-b p-4 bg-gray-50'},P={class:'flex-1 overflow-y-auto p-6'},T={class:'text-center space-y-2'},L={class:'text-gray-600'},O={class:'font-semibold text-gray-900'},I={class:'flex justify-end gap-3 border-t p-4 bg-gray-50'},Y=(0,d.defineComponent)({__name:'DeleteBranchModal',props:{branchName:{}},emits:['close','delete'],setup(e,{emit:t}){const n=t,o=j({mobile:640}).smaller('mobile');function a(){n('delete')}return(t,n)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',S,[(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['w-full max-w-md bg-white rounded-lg shadow-xl overflow-hidden flex flex-col',{'h-full rounded-none':(0,d.unref)(o)}])},[(0,d.createCommentVNode)(' 标题栏 '),(0,d.createElementVNode)('div',D,[n[3]||(n[3]=(0,d.createElementVNode)('h2',{class:'text-lg font-semibold'},'删除分支',-1)),(0,d.createElementVNode)('button',{onClick:n[0]||(n[0]=e=>t.$emit('close')),class:'p-2 touch-manipulation hover:bg-gray-200 rounded-lg transition-colors'},[...n[2]||(n[2]=[(0,d.createElementVNode)('i',{class:'fas fa-times text-xl text-gray-600'},null,-1)])])]),(0,d.createCommentVNode)(' 内容区 '),(0,d.createElementVNode)('div',P,[(0,d.createCommentVNode)(' 警告图标 '),n[7]||(n[7]=(0,d.createElementVNode)('div',{class:'flex justify-center mb-4'},[(0,d.createElementVNode)('div',{class:'w-16 h-16 rounded-full bg-red-100 flex items-center justify-center'},[(0,d.createElementVNode)('i',{class:'fas fa-exclamation-triangle text-3xl text-red-500'})])],-1)),(0,d.createCommentVNode)(' 警告文字 '),(0,d.createElementVNode)('div',T,[n[6]||(n[6]=(0,d.createElementVNode)('h3',{class:'text-lg font-semibold text-gray-900'},'确定要删除此分支吗？',-1)),(0,d.createElementVNode)('p',L,[n[4]||(n[4]=(0,d.createTextVNode)(' 分支 ',-1)),(0,d.createElementVNode)('span',O,'"'+(0,d.toDisplayString)(e.branchName)+'"',1),n[5]||(n[5]=(0,d.createTextVNode)(' 将被永久删除，此操作无法撤销。 ',-1))])])]),(0,d.createCommentVNode)(' 底部按钮 '),(0,d.createElementVNode)('div',I,[(0,d.createElementVNode)('button',{onClick:n[1]||(n[1]=e=>t.$emit('close')),class:'px-6 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors touch-manipulation min-h-[44px]'},' 取消 '),(0,d.createElementVNode)('button',{onClick:a,class:'px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 active:bg-red-700 transition-colors touch-manipulation min-h-[44px]'},' 删除 ')])],2)]))}}),q={class:'fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4'},R={class:'flex items-center justify-between border-b p-4 bg-gray-50'},U={class:'flex-1 overflow-y-auto p-4'},W={class:'mb-4'},H={class:'font-medium'},F={class:'space-y-2'},G={class:'flex-1 min-w-0 pr-3'},Q={class:'text-sm font-medium truncate'},J={key:0,class:'text-xs text-gray-500 truncate mt-1'},X=['onUpdate:modelValue'],K={key:0,class:'p-8 text-center text-gray-500 text-sm'},Z={class:'flex justify-end gap-3 border-t p-4 bg-gray-50'},ee=(0,d.defineComponent)({__name:'EditPromptsModal',props:{presetName:{},prompts:{}},emits:['close','saveAsNewBranch'],setup(e,{emit:t}){const n=e,o=t,a=j({mobile:640}).smaller('mobile');function r(){const e={};n.prompts.forEach(t=>{t.id&&(e[t.id]=t.enabled)}),o('saveAsNewBranch',e)}return(t,n)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',q,[(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['w-full max-w-2xl bg-white rounded-lg shadow-xl overflow-hidden flex flex-col',{'h-full rounded-none':(0,d.unref)(a)}])},[(0,d.createCommentVNode)(' 标题栏 '),(0,d.createElementVNode)('div',R,[n[3]||(n[3]=(0,d.createElementVNode)('h2',{class:'text-lg font-semibold'},'修改预设条目',-1)),(0,d.createElementVNode)('button',{onClick:n[0]||(n[0]=e=>t.$emit('close')),class:'p-2 touch-manipulation hover:bg-gray-200 rounded-lg transition-colors'},[...n[2]||(n[2]=[(0,d.createElementVNode)('i',{class:'fas fa-times text-xl text-gray-600'},null,-1)])])]),(0,d.createCommentVNode)(' 内容区 '),(0,d.createElementVNode)('div',U,[(0,d.createElementVNode)('div',W,[n[4]||(n[4]=(0,d.createElementVNode)('span',{class:'text-sm text-gray-600'},'当前预设：',-1)),(0,d.createElementVNode)('span',H,(0,d.toDisplayString)(e.presetName),1)]),(0,d.createElementVNode)('div',F,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(e.prompts,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:(0,d.normalizeClass)(['flex items-center justify-between p-3 border rounded-lg transition-colors',{'bg-blue-50 border-blue-300':e.enabled,'hover:bg-gray-50':!e.enabled}])},[(0,d.createElementVNode)('div',G,[(0,d.createElementVNode)('div',Q,(0,d.toDisplayString)(e.name),1),e.content?((0,d.openBlock)(),(0,d.createElementBlock)('div',J,(0,d.toDisplayString)(e.content),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.withDirectives)((0,d.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t=>e.enabled=t,class:'w-5 h-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500 touch-manipulation cursor-pointer'},null,8,X),[[d.vModelCheckbox,e.enabled]])],2))),128)),e.prompts.length?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('div',K,' 暂无提示词条目 '))])]),(0,d.createCommentVNode)(' 底部按钮 '),(0,d.createElementVNode)('div',Z,[(0,d.createElementVNode)('button',{onClick:n[1]||(n[1]=e=>t.$emit('close')),class:'px-6 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors touch-manipulation min-h-[44px]'},' 取消 '),(0,d.createElementVNode)('button',{onClick:r,class:'px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 active:bg-blue-700 transition-colors touch-manipulation min-h-[44px]'},' 保存为新分支 ')])],2)]))}}),te='preset_branches';function ne(){return getVariables({type:'script',script_id:getScriptId()})[te]||{}}function oe(e){replaceVariables({...getVariables({type:'script',script_id:getScriptId()}),[te]:e},{type:'script',script_id:getScriptId()})}function ae(e){return ne()[e]||null}function re(e){const t=ae(e);return t&&t.branches?Object.entries(t.branches).map(([e,n])=>({name:e,description:n.description,createdAt:n.createdAt,updatedAt:n.updatedAt,isActive:e===t.activeBranch})):[]}function le(e){const t=ae(e);return t?.activeBranch||null}function ce(){try{const e=getPreset('in_use');return e&&e.prompts?e.prompts.map(e=>({id:e.id||'',name:e.name||'未命名提示词',enabled:e.enabled||!1,content:e.content||''})):[]}catch(e){return console.error('获取预设提示词失败:',e),[]}}const ie={key:0,class:'mobile-container'},se={class:'mobile-fullscreen'},de={class:'mobile-content'},me=['value'],ue={class:'flex gap-2'},pe={key:0,value:''},fe=['value'],he={key:0,class:'branch-list-mobile'},ve=['onClick'],ge={class:'flex items-center justify-between'},Ae={class:'flex-1 min-w-0'},be={class:'text-sm font-medium truncate'},xe={key:0,class:'text-xs text-gray-500 truncate mt-1'},Be={key:0,class:'fas fa-check text-blue-500 ml-2'},Ce={class:'flex flex-col gap-2 pt-2'},ye={key:0,class:'flex gap-2'},we={class:'desktop-container'},ke={class:'desktop-toolbar'},Ee=['value'],Ne={key:0,value:''},Ve=['value'],Me={key:0,class:'flex gap-1'},je={class:'branch-list-desktop'},Se={key:0,class:'p-4 text-center text-gray-500 text-sm'},De={key:1,class:'divide-y'},Pe=['onClick'],Te={class:'flex items-center justify-between'},Le={class:'flex-1 min-w-0'},Oe={class:'text-sm font-medium truncate'},Ie={key:0,class:'text-xs text-gray-500 truncate mt-1'},ze={key:0,class:'fas fa-check text-blue-500'},_e=(0,d.defineComponent)({__name:'FloatingWindow',emits:['edit','rename','delete'],setup(e,{expose:t,emit:n}){const o=n,a=j({mobile:640}).smaller('mobile'),l=(0,d.ref)(!0),c=(0,d.ref)(null),i=(0,d.ref)([]),m=(0,d.ref)(''),u=(0,d.ref)([]),p=(0,d.ref)('');function f(){return window.frameElement}function h(){const e=f();if(!e)return;const t=r()(e);a.value?l.value?t.css({position:'fixed',top:0,left:0,right:0,bottom:0,width:'100%',height:'100%',transform:'none',maxHeight:'none'}):t.css({position:'fixed',top:'auto',left:'auto',right:'16px',bottom:'16px',width:'56px',height:'56px',transform:'none',maxHeight:'none'}):(t.css({position:'fixed',right:'auto',bottom:'auto',width:'320px',height:'auto',maxHeight:'80vh'}),(0,d.nextTick)(()=>{const e=document.body.scrollHeight;t.css('height',Math.min(e,.8*window.parent.innerHeight)+'px')}))}function v(){if(!c.value)return;const e=f();if(!e)return;const t=r()(e),n=localStorage.getItem('preset-branch-position');if(n)try{const{left:e,top:o}=JSON.parse(n);t.css({left:e+'px',top:o+'px',transform:'none'})}catch(e){console.error('恢复悬浮窗位置失败:',e)}let o=!1,a=0,l=0,i=0,s=0;c.value.addEventListener('mousedown',t=>{o=!0,a=t.clientX,l=t.clientY;const n=e.getBoundingClientRect();i=n.left,s=n.top,t.preventDefault()}),window.parent.document.addEventListener('mousemove',e=>{if(!o)return;const n=e.clientX-a,r=e.clientY-l,c=i+n,d=s+r;t.css({left:c+'px',top:d+'px',transform:'none'})}),window.parent.document.addEventListener('mouseup',()=>{if(o){o=!1;const t=e.getBoundingClientRect();localStorage.setItem('preset-branch-position',JSON.stringify({left:t.left,top:t.top}))}})}async function g(){try{const e=function(){try{return getLoadedPresetName()}catch(e){return console.error('获取当前预设名称失败:',e),''}}();e&&(m.value=e,await A(m.value),p.value=le(m.value)||'')}catch(e){console.error('加载当前预设失败:',e)}}async function A(e){try{u.value=re(e)}catch(e){console.error('加载分支列表失败:',e),u.value=[]}}async function b(){try{await A(m.value),p.value=le(m.value)||''}catch(e){console.error('切换预设失败:',e),s().error('切换预设失败')}}async function x(){if(p.value)try{(function(e,t){const n=ne(),o=n[e];if(!o||!o.branches[t])return!1;const a=o.branches[t];try{const e=getPreset('in_use');return e&&e.prompts?(e.prompts.forEach(e=>{e.id&&a.promptsEnabled.hasOwnProperty(e.id)&&(e.enabled=a.promptsEnabled[e.id])}),replacePreset('in_use',e),o.activeBranch=t,oe(n),!0):(console.error('无法获取当前预设'),!1)}catch(e){return console.error('切换分支失败:',e),!1}})(m.value,p.value)?(await A(m.value),s().success('切换分支成功')):s().error('切换分支失败')}catch(e){console.error('切换分支失败:',e),s().error('切换分支失败')}}async function B(e){p.value=e,await x()}function C(){l.value=!l.value}function y(){o('edit')}function w(){p.value&&o('rename',p.value)}function k(){p.value&&o('delete',p.value)}return(0,d.onMounted)(async()=>{await async function(){try{const e=await async function(){try{return getPresetNames()||[]}catch(e){return console.error('获取预设列表失败:',e),[]}}();i.value=e}catch(e){console.error('加载预设列表失败:',e),s().error('加载预设列表失败')}}(),await g(),h(),a.value||(await(0,d.nextTick)(),v())}),(0,d.watch)(l,()=>{(0,d.nextTick)(()=>{h(),!a.value&&l.value&&(0,d.nextTick)(v)})}),(0,d.watch)(u,()=>{a.value||(0,d.nextTick)(h)},{deep:!0}),t({refreshPreset:g,refreshBranches:async()=>{m.value&&await A(m.value)}}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,null,[(0,d.createCommentVNode)(' 移动端：底部浮动按钮 '),(0,d.unref)(a)?((0,d.openBlock)(),(0,d.createElementBlock)('div',ie,[l.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 移动端全屏展开 '),(0,d.createElementVNode)('div',se,[(0,d.createElementVNode)('div',{class:'mobile-header'},[t[6]||(t[6]=(0,d.createElementVNode)('h2',{class:'text-lg font-semibold'},'预设分支管理',-1)),(0,d.createElementVNode)('button',{onClick:C,class:'p-2'},[...t[5]||(t[5]=[(0,d.createElementVNode)('i',{class:'fas fa-times text-xl text-gray-600'},null,-1)])])]),(0,d.createElementVNode)('div',de,[(0,d.createCommentVNode)(' 预设选择 '),(0,d.createElementVNode)('div',null,[t[7]||(t[7]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},'选择预设',-1)),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[0]||(t[0]=e=>m.value=e),onChange:b,class:'w-full min-h-[44px] rounded-lg border px-4 py-3 bg-white'},[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(i.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e,value:e},(0,d.toDisplayString)(e),9,me))),128))],544),[[d.vModelSelect,m.value]])]),(0,d.createCommentVNode)(' 分支选择 '),(0,d.createElementVNode)('div',null,[t[8]||(t[8]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},'选择分支',-1)),(0,d.createElementVNode)('div',ue,[(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[1]||(t[1]=e=>p.value=e),onChange:x,class:'flex-1 min-h-[44px] rounded-lg border px-4 py-3 bg-white'},[u.value.length?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('option',pe,'无分支')),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e.name,value:e.name},(0,d.toDisplayString)(e.name),9,fe))),128))],544),[[d.vModelSelect,p.value]])])]),(0,d.createCommentVNode)(' 分支列表 '),u.value.length>0?((0,d.openBlock)(),(0,d.createElementBlock)('div',he,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.name,onClick:t=>B(e.name),class:(0,d.normalizeClass)(['branch-item-mobile',e.isActive?'active':''])},[(0,d.createElementVNode)('div',ge,[(0,d.createElementVNode)('div',Ae,[(0,d.createElementVNode)('div',be,(0,d.toDisplayString)(e.name),1),e.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',xe,(0,d.toDisplayString)(e.description),1)):(0,d.createCommentVNode)('v-if',!0)]),e.isActive?((0,d.openBlock)(),(0,d.createElementBlock)('i',Be)):(0,d.createCommentVNode)('v-if',!0)])],10,ve))),128))])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' 操作按钮 '),(0,d.createElementVNode)('div',Ce,[(0,d.createElementVNode)('button',{onClick:y,class:'w-full min-h-[44px] rounded-lg bg-blue-500 px-4 py-3 text-white font-medium'},[...t[9]||(t[9]=[(0,d.createElementVNode)('i',{class:'fas fa-edit mr-2'},null,-1),(0,d.createTextVNode)('修改条目 ',-1)])]),p.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',ye,[(0,d.createElementVNode)('button',{onClick:w,class:'flex-1 min-h-[44px] rounded-lg bg-gray-200 px-4 py-3 font-medium'},[...t[10]||(t[10]=[(0,d.createElementVNode)('i',{class:'fas fa-edit mr-2'},null,-1),(0,d.createTextVNode)('重命名 ',-1)])]),(0,d.createElementVNode)('button',{onClick:k,class:'flex-1 min-h-[44px] rounded-lg bg-red-500 px-4 py-3 text-white font-medium'},[...t[11]||(t[11]=[(0,d.createElementVNode)('i',{class:'fas fa-trash mr-2'},null,-1),(0,d.createTextVNode)('删除 ',-1)])])])):(0,d.createCommentVNode)('v-if',!0)])])])],2112)):((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,onClick:C,class:'mobile-fab'},[...t[4]||(t[4]=[(0,d.createElementVNode)('i',{class:'fas fa-code-branch text-2xl text-white'},null,-1)])]))])):((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 桌面端：悬浮窗 '),(0,d.createElementVNode)('div',we,[(0,d.createCommentVNode)(' 折叠状态 '),l.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:1},[(0,d.createCommentVNode)(' 展开状态 '),(0,d.createElementVNode)('div',null,[(0,d.createCommentVNode)(' 顶部栏 '),(0,d.createElementVNode)('div',{class:'desktop-header',ref_key:'dragHandle',ref:c},[t[14]||(t[14]=(0,d.createElementVNode)('span',{class:'text-sm font-medium'},'预设分支',-1)),(0,d.createElementVNode)('button',{onClick:C,class:'text-gray-400 hover:text-gray-600'},[...t[13]||(t[13]=[(0,d.createElementVNode)('i',{class:'fas fa-chevron-up'},null,-1)])])],512),(0,d.createCommentVNode)(' 工具栏 '),(0,d.createElementVNode)('div',ke,[(0,d.createElementVNode)('button',{onClick:y,class:'px-3 py-1.5 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors'},' 修改 '),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>m.value=e),onChange:b,class:'flex-1 text-sm border rounded px-2 py-1.5 bg-white cursor-pointer'},[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(i.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e,value:e},(0,d.toDisplayString)(e),9,Ee))),128))],544),[[d.vModelSelect,m.value]]),(0,d.withDirectives)((0,d.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>p.value=e),onChange:x,class:'flex-1 text-sm border rounded px-2 py-1.5 bg-white cursor-pointer'},[u.value.length?(0,d.createCommentVNode)('v-if',!0):((0,d.openBlock)(),(0,d.createElementBlock)('option',Ne,'无分支')),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('option',{key:e.name,value:e.name},(0,d.toDisplayString)(e.name),9,Ve))),128))],544),[[d.vModelSelect,p.value]]),p.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Me,[(0,d.createElementVNode)('button',{onClick:w,class:'p-1.5 text-gray-500 hover:text-gray-700 transition-colors',title:'重命名'},[...t[15]||(t[15]=[(0,d.createElementVNode)('i',{class:'fas fa-edit text-xs'},null,-1)])]),(0,d.createElementVNode)('button',{onClick:k,class:'p-1.5 text-red-500 hover:text-red-700 transition-colors',title:'删除'},[...t[16]||(t[16]=[(0,d.createElementVNode)('i',{class:'fas fa-trash text-xs'},null,-1)])])])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 分支列表 '),(0,d.createElementVNode)('div',je,[u.value.length?((0,d.openBlock)(),(0,d.createElementBlock)('div',De,[((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(u.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.name,onClick:t=>B(e.name),class:(0,d.normalizeClass)(['branch-item-desktop',e.isActive?'active':''])},[(0,d.createElementVNode)('div',Te,[(0,d.createElementVNode)('div',Le,[(0,d.createElementVNode)('div',Oe,(0,d.toDisplayString)(e.name),1),e.description?((0,d.openBlock)(),(0,d.createElementBlock)('div',Ie,(0,d.toDisplayString)(e.description),1)):(0,d.createCommentVNode)('v-if',!0)]),e.isActive?((0,d.openBlock)(),(0,d.createElementBlock)('i',ze)):(0,d.createCommentVNode)('v-if',!0)])],10,Pe))),128))])):((0,d.openBlock)(),(0,d.createElementBlock)('div',Se,' 暂无分支 '))])])],2112)):((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:0,class:'desktop-collapsed',onClick:C},[...t[12]||(t[12]=[(0,d.createElementVNode)('span',{class:'text-sm font-medium'},'预设分支',-1),(0,d.createElementVNode)('i',{class:'fas fa-chevron-down text-gray-400'},null,-1)])]))])],2112))],2112))}});o(102);const Ye=(0,o(889).A)(_e,[['__scopeId','data-v-4dc74265']]),$e={class:'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 p-4'},qe={class:'flex items-center justify-between border-b p-4 bg-gray-50'},Re={class:'flex-1 overflow-y-auto p-4 space-y-4'},Ue={class:'px-4 py-3 bg-gray-100 rounded-lg text-sm text-gray-600'},We=['placeholder'],He={key:0,class:'text-red-500 text-sm mt-1'},Fe={class:'flex justify-end gap-3 border-t p-4 bg-gray-50'},Ge=['disabled'],Qe=(0,d.defineComponent)({__name:'RenameBranchModal',props:{oldName:{},existingBranches:{}},emits:['close','rename'],setup(e,{emit:t}){const n=e,o=t,a=j({mobile:640}).smaller('mobile'),r=(0,d.ref)(n.oldName),l=(0,d.computed)(()=>r.value?r.value===n.oldName?'新名称与原名称相同':n.existingBranches.includes(r.value)?'分支名称已存在':'':'分支名称不能为空');function c(){l.value||o('rename',r.value)}return(t,n)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',$e,[(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['w-full max-w-md bg-white rounded-lg shadow-xl overflow-hidden flex flex-col',{'h-full rounded-none':(0,d.unref)(a)}])},[(0,d.createCommentVNode)(' 标题栏 '),(0,d.createElementVNode)('div',qe,[n[4]||(n[4]=(0,d.createElementVNode)('h2',{class:'text-lg font-semibold'},'重命名分支',-1)),(0,d.createElementVNode)('button',{onClick:n[0]||(n[0]=e=>t.$emit('close')),class:'p-2 touch-manipulation hover:bg-gray-200 rounded-lg transition-colors'},[...n[3]||(n[3]=[(0,d.createElementVNode)('i',{class:'fas fa-times text-xl text-gray-600'},null,-1)])])]),(0,d.createCommentVNode)(' 内容区 '),(0,d.createElementVNode)('div',Re,[(0,d.createCommentVNode)(' 当前分支名称 '),(0,d.createElementVNode)('div',null,[n[5]||(n[5]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},'当前分支名称',-1)),(0,d.createElementVNode)('div',Ue,(0,d.toDisplayString)(e.oldName),1)]),(0,d.createCommentVNode)(' 新分支名称 '),(0,d.createElementVNode)('div',null,[n[6]||(n[6]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},[(0,d.createTextVNode)(' 新分支名称 '),(0,d.createElementVNode)('span',{class:'text-red-500'},'*')],-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':n[1]||(n[1]=e=>r.value=e),type:'text',placeholder:e.oldName,class:(0,d.normalizeClass)(['w-full min-h-[44px] rounded-lg border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-manipulation',{'border-red-500':l.value}])},null,10,We),[[d.vModelText,r.value]]),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('p',He,(0,d.toDisplayString)(l.value),1)):(0,d.createCommentVNode)('v-if',!0)])]),(0,d.createCommentVNode)(' 底部按钮 '),(0,d.createElementVNode)('div',Fe,[(0,d.createElementVNode)('button',{onClick:n[2]||(n[2]=e=>t.$emit('close')),class:'px-6 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors touch-manipulation min-h-[44px]'},' 取消 '),(0,d.createElementVNode)('button',{onClick:c,disabled:!r.value||!!l.value,class:'px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors touch-manipulation min-h-[44px]'},' 重命名 ',8,Ge)])],2)]))}}),Je={class:'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 p-4'},Xe={class:'flex items-center justify-between border-b p-4 bg-gray-50'},Ke={class:'flex-1 overflow-y-auto p-4 space-y-4'},Ze={key:0,class:'text-red-500 text-sm mt-1'},et={class:'flex justify-end gap-3 border-t p-4 bg-gray-50'},tt=['disabled'],nt=(0,d.defineComponent)({__name:'SaveBranchModal',props:{existingBranches:{}},emits:['close','save'],setup(e,{emit:t}){const n=e,o=t,a=j({mobile:640}).smaller('mobile'),r=(0,d.ref)(''),l=(0,d.ref)(''),c=(0,d.computed)(()=>r.value?n.existingBranches.includes(r.value)?'分支名称已存在':'':'分支名称不能为空');function i(){c.value||o('save',r.value,l.value)}return(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',Je,[(0,d.createElementVNode)('div',{class:(0,d.normalizeClass)(['w-full max-w-md bg-white rounded-lg shadow-xl overflow-hidden flex flex-col',{'h-full rounded-none':(0,d.unref)(a)}])},[(0,d.createCommentVNode)(' 标题栏 '),(0,d.createElementVNode)('div',Xe,[t[5]||(t[5]=(0,d.createElementVNode)('h2',{class:'text-lg font-semibold'},'保存为新分支',-1)),(0,d.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.$emit('close')),class:'p-2 touch-manipulation hover:bg-gray-200 rounded-lg transition-colors'},[...t[4]||(t[4]=[(0,d.createElementVNode)('i',{class:'fas fa-times text-xl text-gray-600'},null,-1)])])]),(0,d.createCommentVNode)(' 内容区 '),(0,d.createElementVNode)('div',Ke,[(0,d.createCommentVNode)(' 分支名称 '),(0,d.createElementVNode)('div',null,[t[6]||(t[6]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},[(0,d.createTextVNode)(' 分支名称 '),(0,d.createElementVNode)('span',{class:'text-red-500'},'*')],-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>r.value=e),type:'text',placeholder:'输入分支名称',class:(0,d.normalizeClass)(['w-full min-h-[44px] rounded-lg border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-manipulation',{'border-red-500':c.value}])},null,2),[[d.vModelText,r.value]]),c.value?((0,d.openBlock)(),(0,d.createElementBlock)('p',Ze,(0,d.toDisplayString)(c.value),1)):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' 分支描述 '),(0,d.createElementVNode)('div',null,[t[7]||(t[7]=(0,d.createElementVNode)('label',{class:'block text-sm font-medium mb-2'},'描述（可选）',-1)),(0,d.withDirectives)((0,d.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>l.value=e),placeholder:'输入分支描述',rows:'3',class:'w-full min-h-[44px] rounded-lg border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-manipulation resize-none'},null,512),[[d.vModelText,l.value]])])]),(0,d.createCommentVNode)(' 底部按钮 '),(0,d.createElementVNode)('div',et,[(0,d.createElementVNode)('button',{onClick:t[3]||(t[3]=t=>e.$emit('close')),class:'px-6 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors touch-manipulation min-h-[44px]'},' 取消 '),(0,d.createElementVNode)('button',{onClick:i,disabled:!r.value||!!c.value,class:'px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors touch-manipulation min-h-[44px]'},' 保存 ',8,tt)])],2)]))}});async function ot(){if(console.info('[预设分支管理] 脚本初始化开始'),'undefined'==typeof getPreset||'undefined'==typeof replacePreset)return console.error('[预设分支管理] 预设接口不可用'),void s().error('预设分支管理：预设接口不可用');const t=(0,d.createApp)({components:{FloatingWindow:Ye,EditPromptsModal:ee,SaveBranchModal:nt,RenameBranchModal:Qe,DeleteBranchModal:Y},setup(){const e=(0,d.ref)(!1),t=(0,d.ref)(!1),n=(0,d.ref)(!1),o=(0,d.ref)(!1),a=(0,d.ref)([]),r=(0,d.ref)(''),l=(0,d.ref)(''),i=(0,d.ref)(''),m=(0,d.ref)(''),u=(0,d.ref)(''),p=(0,d.ref)(''),f=(0,d.ref)(null);eventOn(tavern_events.PRESET_CHANGED,async()=>{console.info('[预设分支管理] 预设已变更，刷新界面'),f.value&&await f.value.refreshPreset()});const h=c().debounce(()=>{try{const e=getLoadedPresetName();if(e&&le(e)){!function(e,t){const n=ne(),o=n[e];if(!o||!o.activeBranch)return;const a=o.activeBranch;o.branches[a]&&(o.branches[a].promptsEnabled={...t},o.branches[a].updatedAt=Date.now(),oe(n))}(e,function(){const e=ce(),t={};return e.forEach(e=>{e.id&&(t[e.id]=e.enabled)}),t}())}}catch(e){console.error('[预设分支管理] 更新激活分支失败:',e)}},1e3);let v=null;return setInterval(()=>{try{const e=getPreset('in_use'),t=JSON.stringify(e.prompts?.map(e=>({id:e.id,enabled:e.enabled})));v&&v!==t&&(console.info('[预设分支管理] 检测到预设变更'),h()),v=t}catch(e){}},2e3),{showEditModal:e,showSaveModal:t,showRenameModal:n,showDeleteModal:o,editPrompts:a,editPresetName:r,saveBranchName:l,saveBranchDescription:i,renameOldName:m,renameNewName:u,deleteBranchName:p,floatingWindowRef:f,openEditModal:function(){try{r.value=getLoadedPresetName()||'未知预设',a.value=ce(),e.value=!0}catch(e){console.error('[预设分支管理] 打开编辑弹窗失败:',e),s().error('打开编辑弹窗失败')}},openSaveBranchModal:function(e){a.value.forEach(t=>{t.id&&e.hasOwnProperty(t.id)&&(t.enabled=e[t.id])});const n=getLoadedPresetName();if(n){re(n).map(e=>e.name);t.value=!0}},saveNewBranch:function(e,n){try{const o={};a.value.forEach(e=>{e.id&&(o[e.id]=e.enabled)});const r=getLoadedPresetName();if(!r)return void s().error('无法获取当前预设名称');const c=function(e,t,n,o){const a=ne();a[e]||(a[e]={activeBranch:null,branches:{}});const r=a[e];if(r.branches[t])return!1;const l=Date.now(),c={promptsEnabled:{...n},createdAt:l,updatedAt:l,description:o};return r.branches[t]=c,r.activeBranch=t,oe(a),!0}(r,e,o,n);c?(t.value=!1,l.value='',i.value='',f.value&&f.value.refreshBranches(),s().success(`分支 "${e}" 创建成功`)):s().error('分支创建失败，可能名称已存在')}catch(e){console.error('[预设分支管理] 保存分支失败:',e),s().error('保存分支失败')}},openRenameModal:function(e){m.value=e,u.value=e,n.value=!0},renameBranchAction:function(e){try{const t=getLoadedPresetName();if(!t)return void s().error('无法获取当前预设名称');(function(e,t,n){const o=ne(),a=o[e];return!(!a||!a.branches[t]||a.branches[n]||(a.branches[n]={...a.branches[t],updatedAt:Date.now()},a.activeBranch===t&&(a.activeBranch=n),delete a.branches[t],oe(o),0))})(t,m.value,e)?(n.value=!1,m.value='',u.value='',f.value&&f.value.refreshBranches(),s().success('分支重命名成功')):s().error('分支重命名失败，可能名称已存在')}catch(e){console.error('[预设分支管理] 重命名分支失败:',e),s().error('重命名分支失败')}},openDeleteModal:function(e){p.value=e,o.value=!0},deleteBranchAction:function(){try{const e=getLoadedPresetName();if(!e)return void s().error('无法获取当前预设名称');(function(e,t){const n=ne(),o=n[e];if(!o||!o.branches[t])return!1;if(o.activeBranch===t){const e=Object.keys(o.branches).filter(e=>e!==t);o.activeBranch=e.length>0?e[0]:null}return delete o.branches[t],0===Object.keys(o.branches).length&&delete n[e],oe(n),!0})(e,p.value)?(o.value=!1,p.value='',f.value&&f.value.refreshBranches(),s().success('分支删除成功')):s().error('分支删除失败')}catch(e){console.error('[预设分支管理] 删除分支失败:',e),s().error('删除分支失败')}},getExistingBranchNames:()=>{const e=getLoadedPresetName();return e?re(e).map(e=>e.name):[]}}},template:'\n      <div>\n        <FloatingWindow ref="floatingWindowRef" @edit="openEditModal" @rename="openRenameModal" @delete="openDeleteModal" />\n        <EditPromptsModal v-if="showEditModal" :preset-name="editPresetName" :prompts="editPrompts" @close="showEditModal = false" @saveAsNewBranch="openSaveBranchModal" />\n        <SaveBranchModal v-if="showSaveModal" :existing-branches="getExistingBranchNames()" @close="showSaveModal = false" @save="saveNewBranch" />\n        <RenameBranchModal v-if="showRenameModal" :old-name="renameOldName" :existing-branches="getExistingBranchNames()" @close="showRenameModal = false" @rename="renameBranchAction" />\n        <DeleteBranchModal v-if="showDeleteModal" :branch-name="deleteBranchName" @close="showDeleteModal = false" @delete="deleteBranchAction" />\n      </div>\n    '}),n=e();t.use(n);const o=r()('<iframe>').attr({script_id:getScriptId(),frameborder:'0',srcdoc:'<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">\n<script src="https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/lib/tailwindcss.min.js"><\/script>\n<script src="https://testingcf.jsdelivr.net/npm/jquery"><\/script>\n<script src="https://testingcf.jsdelivr.net/npm/jquery-ui/dist/jquery-ui.min.js"><\/script>\n<link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/jquery-ui/themes/base/theme.min.css" />\n<script src="https://testingcf.jsdelivr.net/npm/jquery-ui-touch-punch"><\/script>\n<script src="https://testingcf.jsdelivr.net/npm/lodash"><\/script>\n<style>\n*,*::before,*::after{box-sizing:border-box;}\nhtml,body{margin:0!important;padding:0;overflow:hidden!important;max-width:100%!important;}\n</style>\n</head>\n<body></body>\n</html>'}).css({position:'fixed',top:'50%',left:'50%',transform:'translate(-50%, -50%)',width:'320px',height:'auto',minHeight:'60px',maxHeight:'80vh',border:'none',zIndex:9999,background:'transparent',pointerEvents:'auto'}).appendTo('body').on('load',function(){const e=this.contentDocument;!function(e='head'){const t=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone()).appendTo(e)}(e.head),t.mount(e.body),console.info('[预设分支管理] 脚本初始化完成'),s().success('预设分支管理已加载')});r()(window).on('pagehide',()=>{t.unmount(),o.remove(),console.info('[预设分支管理] 脚本已卸载')})}r()(()=>{errorCatched(ot)()});
//# sourceMappingURL=index.js.map